{% extends "base.html" %}

{% block title %}{{ item.Item_name }}{% endblock %}

{% block body %}
<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-body">
            <h2 class="card-title">{{ item.Item_name }}</h2>
            <p class="text-muted">Category: {{ item.Item_category.Category_name|default:"Uncategorized" }}</p>
            <p class="card-text"><strong>Price:</strong> ${{ item.Item_price }}</p>
            <p class="card-text"><strong>Available Quantity:</strong> {{ item.Item_quantity }}</p>
            <p class="card-text"><strong>Owner: </strong> 
            <a href="{% url 'accounts:other_profile' profile.slug %}" class="text-decoration-none">
               {{ item.Item_owner }}
            </a></p>
            <p class="card-text">{{ item.Item_description }}</p>
            <p class="text-muted">Published: {{ item.Item_published|yesno:"Yes,No" }}</p>
            <p class="text-muted"><small>Added on: {{ item.Item_createdat|date:"F j, Y, g:i a" }}</small></p>
        </div>
    </div>

    <a href="{% url 'Item:item_list' %}" class="btn btn-secondary mt-3">Back to Listings</a>
    {% if item.Item_owner == request.user %}
    <a href="{% url 'Item:item_update' item.Item_slug %}" class="btn btn-secondary mt-3">Edit</a>
    <a href="{% url 'Item:item_delete' item.Item_slug %}" class="btn btn-secondary mt-3">Delete</a>
    {% else %}
    <a href="{% url 'Market:place_offer' item.Item_slug %}" class="btn btn-secondary mt-3">Place Offer</a>

    {% endif %}
    <h4>Ownership History</h4>
    <table class="table">
        <thead>
            <tr>
                <th>Buyer</th>
                <th>Seller</th>
                <th>Transaction Date</th>
                <th>Amount</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for record in ownership_history %}
                <tr>
                    <td>{{ record.buyer }}</td>
                    <td>{{ record.seller }}</td>
                    <td>{{ record.transaction_date }}</td>
                    <td>${{ record.amount }}</td>
                    <td>{{ record.status|capfirst }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="5">No ownership history available.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

</div>
{% endblock %}
